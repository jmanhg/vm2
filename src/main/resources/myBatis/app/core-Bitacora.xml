<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="mx.com.oposicion.persistence.BitacoraMapper">
    
    <resultMap id="bitacoraMap" type="BitacoraType" >
        <result property="id" column="id"/>
        <result property="username" column="username"/>
        <result property="ip" column="id"/>
        <result property="eventDate" column="eventDate"/>
        <result property="action" column="action"/>
        <result property="extraInfo" column="extraInfo"/>
    </resultMap>
    
	<sql id="camposBitacora">
			id,               
			username,                
			ip,                   
			eventDate,                    
			action,         
			extraInfo
	</sql>
		
    <select id="getNextSquenceValue" resultType="java.lang.Integer">
        select 1; <!-- cambiar por sequence adecuado -->
    </select>
    
    <select id="getById" 
        resultMap="bitacoraMap"
        parameterType="BitacoraType">
        SELECT 
			<include refid="camposBitacora"/>
        FROM 
        	bitacora 
        WHERE 
        	id = #{id}
    </select>

    <select id="getAll" resultMap="bitacoraMap">
        SELECT 
			<include refid="camposBitacora"/>
        FROM 
        	bitacora 
    </select>
    
    <insert id="insert" parameterType="BitacoraType">
        INSERT INTO bitacora(
            username,
            ip,
            eventDate,
            action,
            extraInfo
        ) VALUE (
            #{username},
            #{ip},
            #{eventDate},
            #{action},
            #{extraInfo}
        );
    </insert>
    
    <update id="upeventDate" parameterType="BitacoraType">
        UPDATE bitacora SET
            username = #{username},
            ip = #{ip},
            eventDate = #{eventDate},
            extraInfo = #{extraInfo}
        WHERE id = #{id}
    </update>
    
    <delete id="delete" parameterType="BitacoraType">
        DELETE FROM bitacora WHERE id = #{id}
    </delete>
    
    <delete id="clean" parameterType="mx.com.oposicion.model.DateWrapper">
        DELETE FROM bitacora WHERE eventDate <![CDATA[ < ]]> #{upperLimit}
    </delete>

</mapper>
