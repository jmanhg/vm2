<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd" > 

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="../support/templates/ComplexTemplate.xhtml">

    <ui:define name="pageName">Reporte de gacetas </ui:define>
    <ui:define name="content">

        <f:view encoding="UTF-8" contentType="text/html">
            <h:head>
                <title>#{translatedMessage['title.message']}</title>
                <style>
                    .ui-autocomplete-panel {
                        max-width: 600px;
                        z-index: 2012;
                        overflow:auto;
                     }
                </style>
            </h:head>
            <h:body>
                <h:form id="forma">
                    <h:outputScript library="js" name="calendar_es.js" />
                    <p:focus context="panelSearch"/> 
              <!--      
<p:ajaxStatus onstart="statusDialog.show()" onsuccess="statusDialog.hide()" />
 

<p:dialog modal="true" widgetVar="statusDialog" header="Status" draggable="false" closable="false" resizable="false">  
    <p:graphicImage value="/images/ajax-loader_2.gif" />  
</p:dialog>  -->

                    <p:panel  style="width: 100%" id="panelSearch" >  
                       
                      
                        <p:fieldset legend="Búsqueda Gacetas">
                                  <p:panelGrid  columns="6"  style="border-width: 0px"> 
                                            
                                            <h:outputText value="Tipo:" />
                                            <h:outputText value="Subtipo:" />
                                            <h:outputText value="Registro:" />
                                            <h:outputText value="Solicitud:" />
                                            <h:outputText value="Fecha Presentación:" />
                                            <h:outputText value="" />
                                            
                                            
                                            <p:selectOneMenu id="tipo" value="#{gacetaMB.tipo}" style="width:125px">
                                            <f:selectItem itemLabel="Seleccionar..." itemValue="" />
                                            <f:selectItem itemLabel="Solicitud de Marcas" itemValue="SM" />
                                            <f:selectItem itemLabel="Marcas" itemValue="M" />
                                            <f:selectItem itemLabel="Marcas Renovadas" itemValue="MR" />
                                            <f:selectItem itemLabel="Marcas Canceladas" itemValue="MC" />
                                            <f:selectItem itemLabel="Aviso Comercial" itemValue="AC" />
                                            <f:selectItem itemLabel="Nombre Comercial" itemValue="NC" />
                                            <f:selectItem itemLabel="Aviso Nombre Renovadas" itemValue="AVNC" />
                                            <f:selectItem itemLabel="Solicitud de Marca Abandonada" itemValue="SMA" />
                                            <f:selectItem itemLabel="Marcas Caducas" itemValue="MCAD" />
                                            </p:selectOneMenu>
                                            
                                            <p:selectOneMenu id="subtipo" value="#{gacetaMB.subtipo}" style="width:125px">
                                            <f:selectItem itemLabel="Seleccionar..." itemValue="" />
                                            <f:selectItem itemLabel="NOMINATIVA" itemValue="1" />
                                            <f:selectItem itemLabel="DISEÑO" itemValue="2" />
                                            <f:selectItem itemLabel="MIXTA" itemValue="3" />
                                            <f:selectItem itemLabel="TRIDIMENSIONAL" itemValue="4" />
                                            <f:selectItem itemLabel="MIXTA (Den. y Dis. T.)" itemValue="5" />
                                            <f:selectItem itemLabel="MIXTA (Dis. y Forma T.)" itemValue="6" />
                                            <f:selectItem itemLabel="MIXTA (Den., Dis. y Forma T.)" itemValue="7" />
                                            </p:selectOneMenu>
                                            <p:inputText value="#{gacetaMB.registro}" />
                                            <p:inputText value="#{gacetaMB.solicitud}" />
                                            <p:calendar id="fechaPub2" 
                                                  value="#{gacetaMB.fechaPub2}"  showButtonPanel="true" navigator="true" pattern="yyyy/MM/dd" locale="es"  >
                                             </p:calendar>
                                            <h:outputText value="" />
                                            <p:commandButton actionListener="#{gacetaMB.searchRegistroF(1)}" 
                                                             update="gacetaTable" value="Buscar todos..."  style="margin:0"
                                                             onstart="statusDialog.show();" 
                                                             oncomplete="statusDialog.hide();" rendered="false"
                                                            />  
                                            
                                            
                                            <h:outputText value="Denominación:" />
                                            <h:outputText value="Clases:" />
                                            <h:outputText value="Titular:" />
                                            <h:outputText value="Apoderado:" />
                                            <h:outputText value="Fecha publicación:" />
                                            <h:outputText value="" />
                                            <p:inputText value="#{gacetaMB.denominacion}" />
                                            <p:inputText value="#{gacetaMB.clase}" />
                                            <p:inputText value="#{gacetaMB.titular}" />
                                            <p:inputText value="#{gacetaMB.apoderado}" />
                                            <p:calendar id="fechaPub1" 
                                                  value="#{gacetaMB.fechaPub1}"  showButtonPanel="true" navigator="true" pattern="yyyy/MM/dd" locale="es"  >
                                             </p:calendar>
                                            <p:commandButton actionListener="#{gacetaMB.searchRegistroF(0)}" 
                                                             update="gacetaTable" value="Buscar..."  style="margin:0"
                                                             onstart="statusDialog.show();" 
                                                             oncomplete="statusDialog.hide();"
                                                            />  
                                            <h:outputText value="El '%' se puede usar como comodín" />
                                            </p:panelGrid>
                            <br/>
                            <p:dialog id="dlgLista" header="Lista de búsquedas" width="1000px" height="500px" widgetVar="dlgLista"  >

                                   
                             <p:panelGrid  columns="1"  style="border-width: 0px;width: 90%"> 
                                <p:dataTable id="listaTable" 
                                     var="listaSelected" 
                                     value="#{gacetaMB.listaDataModel}" 
                                     selectionMode="single"
                                     resizableColumns="true" 
                                     paginator="true" rows="5"
                                     paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     rowsPerPageTemplate="5,10,15,25"
                                     emptyMessage="No se encontraron registros"
                                     liveResize="true"
                                     rowIndexVar="rowIndex1"
                                    >
                           <p:ajax event="rowSelect" listener="#{gacetaMB.onRowSelectListaData}" update="listaTable :forma:gacetaTable" onstart="statusDialog.show();" oncomplete="dlgLista.hide();statusDialog.hide();" /> 

                            <f:facet name="header">  
                                <h:outputText value=""/>
                            </f:facet>
                             
                            <p:column style="width:15px" >
                                <f:facet name="header" >Lista</f:facet>
                                <h:outputText value="#{listaSelected.idlista}"  />
                            </p:column>
                            <p:column style="width:15px" >
                                <f:facet name="header" >Nombre de Lista</f:facet>
                                <h:outputText value="#{listaSelected.nombre}"  />
                            </p:column>
                             
                            <p:column style="width:100px" >
                                <f:facet name="header">Fecha</f:facet>
                                <h:outputText value="#{listaSelected.fecha}" ><f:convertDateTime pattern="yyyy/MM/dd HH:mm" /> </h:outputText>
                            </p:column>
                                               
                            <p:column style="width:15px" headerText="Borrar" exportable="false">  
                                <p:commandButton id="deleteButtonl" update=":forma:dlgBorrar2l" oncomplete="dlgBorrar2l.show()"  icon="ui-icon-closethick" title="Borrar">  
                                    <f:setPropertyActionListener value="#{listaSelected}" target="#{gacetaMB.listaSelected}"  />  
                                </p:commandButton>  
                            </p:column> 
                             <f:facet name="footer"  >   
                                <p:spacer height="10" width="0" />
                       
                                            
                            </f:facet>
                              
                        </p:dataTable>
                                 <p:dialog id="dlgBorrar2l" header="Eliminar" width="500" height="100" widgetVar="dlgBorrar2l"  >

                                    <p:panel style="width: 90%">
                                        <h:panelGrid columns="2">

                                            <h:outputText value="Nombre:" />
                                            <h:outputText value="#{gacetaMB.listaSelected.nombre}"/>
                                             </h:panelGrid>                    
                                    </p:panel>
                                    <p:commandButton value="Borrar" actionListener="#{gacetaMB.borraRepl(gacetaMB.listaSelected)}" oncomplete="dlgBorrar2l.hide()" update=":forma:listaTable :forma:dlgLista" />
                                    <p:commandButton value="Cancelar"  oncomplete="dlgBorrar2l.hide()" />

                                </p:dialog>
                             </p:panelGrid>
                            </p:dialog>
                                  <p:panelGrid  columns="1"  style="border-width: 0px"> 
                                           <p:dataTable id="gacetaTable" 
                                     var="gacetadataSelected" 
                                     value="#{gacetaMB.gacetadataDataModel}" 
                                     selectionMode="single"
                                     resizableColumns="true" 
                                     paginator="true" rows="15"
                                     paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     rowsPerPageTemplate="5,10,15,25"
                                     emptyMessage="No se encontraron registros"
                                     liveResize="true"
                                     rowIndexVar="rowIndex1"
                                    >
                           <p:ajax event="rowSelect" listener="#{gacetaMB.onRowSelectGacetadataData}" update="gacetaTable " /> 

                            <f:facet name="header">  
                                <h:outputText value="Número de registros encontrados: #{gacetaMB.numRegsBusqueda}" rendered="#{gacetaMB.numRegsBusqueda>0?true:false}"/>
                            </f:facet>
                             <p:column headerText="N°" style="width:15px" exportable="false">
                                #{rowIndex1+1}
                            </p:column>
                           <p:column style="width:15px" rendered="false" exportable="false" >
                                <f:facet name="header" >idRegistro</f:facet>
                                <h:outputText value="#{gacetadataSelected.idRegistro}"  />
                            </p:column>
                            <p:column style="width:15px" >
                                <f:facet name="header" >Tipo</f:facet>
                                <h:outputText value="#{gacetadataSelected.tipo}"  />
                            </p:column>
                           <p:column style="width:15px" rendered="false" >
                                <f:facet name="header" >Subtipo</f:facet>
                                <h:outputText value="#{gacetadataSelected.subtipo}"  />
                            </p:column>
                           
                             <p:column style="width:15px" exportable="false" >
                                <f:facet name="header" >Subtipo</f:facet>
                                <h:outputText value="#{gacetaMB.tipoM(gacetadataSelected.subtipo)}"  />
                            </p:column>
                           <p:column style="width:15px" rendered="false" exportable="false" >
                                <f:facet name="header" >Registro</f:facet>
                                <h:outputText value="#{gacetadataSelected.registro}"  />
                            </p:column>
                            <p:column style="width:15px" >
                                <f:facet name="header" >Solicitud</f:facet>
                                <h:outputText value="#{gacetadataSelected.solicitud}"  />
                            </p:column>
                             
                            <p:column style="width:100px" >
                                <f:facet name="header">Denominación</f:facet>
                                <h:outputText value="#{gacetadataSelected.titulo}" />
                            </p:column>
                            <p:column style="width:60px"   >
                                <f:facet name="header">Clases</f:facet>
                                <h:outputText value="#{gacetadataSelected.clase}" />
                            </p:column>
                           <p:column style="width:40px" >
                                <f:facet name="header">Fecha Pres.</f:facet>
                                <h:outputText value="#{gacetadataSelected.presentacion}" ><f:convertDateTime pattern="dd/MM/yyyy" /> </h:outputText>
                            </p:column>
                           <p:column style="width:100px" >
                                <f:facet name="header">Titular</f:facet>
                                <h:outputText value="#{gacetadataSelected.titular}" />
                            </p:column>
                            <p:column style="width:100px" >
                                <f:facet name="header">Apoderado</f:facet>
                                <h:outputText value="#{gacetadataSelected.apoderado}" />
                            </p:column>
                            <p:column style="width:150px" exportable="false">
                                <f:facet name="header">Imagen</f:facet>
                                
                                <img style="height: 100px;#{gacetadataSelected.diseno=='1'?'':'visibility: hidden;'}" src="#{facesContext.externalContext.requestContextPath}/MostrarReporte?content=image/gif&amp;idRegistro=#{gacetadataSelected.idRegistro}" alt="" />
                               
                            </p:column>
                           <p:column style="width:50px" rendered="false" exportable="false">
                                <f:facet name="header">Gaceta</f:facet>
                                <center>
                                    <h:outputText value="#{gacetadataSelected.gaceta}" /><br/>
                                    <p:commandLink id="downloadLink0" actionListener="#{gacetaMB.dommy()}" rendered="#{gacetadataSelected.pagina>0?true:false}" 
                                                    onstart="statusDialog.show();" oncomplete="document.getElementById('iframeFile').src='#{facesContext.getCurrentInstance().getExternalContext().getRequest().isSecure()==false?'http':'https'}://#{facesContext.externalContext.requestServerName}:#{facesContext.externalContext.requestServerPort}#{facesContext.externalContext.requestContextPath}/content/common/gaceta/#{gacetadataSelected.gaceta}.pdf#page=#{gacetadataSelected.pagina}';reporteDialog.show();statusDialog.hide();" >  

                                            <p:graphicImage value="#{gacetadataSelected.pagina>0? '/images/pdf.png':'/images/pdf.png'}" style="border-style: none"/>

                                    </p:commandLink> 
                                </center>
                            </p:column>
                           <p:column style="width:50px" >
                                <f:facet name="header">Gaceta</f:facet>
                                <center>
                                    <h:outputText value="#{gacetadataSelected.gaceta}" /><br/>
                                    <p:commandLink id="downloadLink1" actionListener="#{gacetaMB.dommy()}" rendered="#{gacetadataSelected.pagina>0?true:false}" 
                                                    onstart="statusDialog.show();" oncomplete="document.getElementById('iframeFile').src='http://vmmex.jl.serv.net.mx/gaceta/#{gacetadataSelected.gaceta}.pdf#page=#{gacetadataSelected.pagina}';reporteDialog.show();statusDialog.hide();" >  

                                            <p:graphicImage value="#{gacetadataSelected.pagina>0? '/images/pdf.png':'/images/pdf.png'}" style="border-style: none"/>

                                    </p:commandLink> 
                                </center>
                            </p:column>
                           <p:column style="width:40px" >
                                <f:facet name="header">Fecha Pub.</f:facet>
                                <h:outputText value="#{gacetadataSelected.fRegistro}" ><f:convertDateTime pattern="dd/MM/yyyy" /> </h:outputText>
                            </p:column>
                           <p:column style="width:15px" headerText="Borrar" exportable="false" rendered="false">  
                                <p:commandButton id="deleteButtong" update=":forma:dlgBorrar2g" oncomplete="dlgBorrar2g.show()"  icon="ui-icon-closethick" title="Borrar">  
                                    <f:setPropertyActionListener value="#{gacetadataSelected}" target="#{gacetaMB.gacetadataSelected}"  />  
                                </p:commandButton>  
                            </p:column> 
                             <f:facet name="footer"  >   
                                <p:spacer height="10" width="0" />
                        <p:commandButton actionListener="#{gacetaMB.searchLimpia}" update="gacetaTable " value="Limpiar..."  style="margin:0"/>  
                        <p:commandButton value="Guardar" update=":forma:dlgGuardaL" oncomplete="dlgGuardaL.show()" rendered="false"/>
                      <p:commandButton value="Cargar lista" actionListener="#{gacetaMB.cargaLista}" update="gacetaTable :forma:listaTable" oncomplete="dlgLista.show()" rendered="false"/>
                                            
                            </f:facet>
                              
                        </p:dataTable>
                                 
                                  </p:panelGrid>
                             <p:dialog id="dlgGuardaL" header="Guardar lista" width="400px" height="200px" widgetVar="dlgGuardaL"  >

                                    <p:panel style="width: 90%">
                                        <h:panelGrid columns="1">

                                            <h:outputText value="Nombre lista*:" />
                                            <p:inputText value="#{gacetaMB.listaName}"  style="width: 150px"/>
                                             </h:panelGrid>                    
                                    </p:panel>
                                    <p:commandButton value="Guardar" actionListener="#{gacetaMB.guardaLista}" oncomplete="dlgGuardaL.hide()" update=":forma:listaTable" />
                                    <p:commandButton value="Cancelar"  oncomplete="dlgGuardaL.hide()" />

                                </p:dialog>    
                                <p:dialog id="dlgBorrar2g" header="Eliminar" width="500" height="100" widgetVar="dlgBorrar2g"  >

                                    <p:panel style="width: 90%">
                                        <h:panelGrid columns="2">

                                            <h:outputText value="Denominación:" />
                                            <h:outputText value="#{gacetaMB.gacetadataSelected.titulo}"/>
                                             </h:panelGrid>                    
                                    </p:panel>
                                    <p:commandButton value="Borrar" actionListener="#{gacetaMB.borraRepg(gacetaMB.gacetadataSelected)}" oncomplete="dlgBorrar2g.hide()" update=":forma:gacetaTable" />
                                    <p:commandButton value="Cancelar"  oncomplete="dlgBorrar2g.hide()" />

                                </p:dialog>
                               <p:dialog id="reporteDialog" closeOnEscape="true" width="1200" height="500"  maximizable="true"
                              header="Vista Previa" widgetVar="reporteDialog" styleClass="ui-widget-overlay"
                              position="center top" rendered="true" >
                        <p:resizable onResize="resizeIframe()" for="reporteDialog"/>
                        <h:panelGrid  style="width: 100%">
                            <script language="javascript" type="text/javascript">
                                function resizeIframe() {
                                    var dlg = document.getElementById('forma:reporteDialog');
                                    var obj = document.getElementById('iframeFile');
                                    //alert(dlg.offsetHeight);
                                    //alert(obj.style.height);
                                    obj.style.height = dlg.offsetHeight + 'px';
                                    obj.style.width = dlg.offsetWidth + 'px';

                                    //alert(obj.style.height);
                                }
                            </script>
                            <iframe id="iframeFile" src="" width="750px" height="425px" onload='javascript:resizeIframe(this);'/>
                        </h:panelGrid>
                        <p:commandButton value="Cancelar"  oncomplete="reporteDialog.hide()" />
                    </p:dialog>
                              <p:dialog  widgetVar="statusDialog" width="100%" height="1200px" appendToBody="true"
                                   style="box-shadow: 0px 0px 0px #888888;
                                   background-color: rgba(0, 0, 0, 0.4);  
                                   position: fixed; 
                                    z-index: 1; 
                                    left: 0;
                                    top: 0;
                                    width: 100%; 
                                    height: 100%; 
                                    overflow: auto; "
                                   showHeader="false"  draggable="false" closable="false" resizable="false">
                            <h:graphicImage value="/images/loader_blue.gif" height="100px" width="100px"
                                                            style="position: absolute;left: 45%; top: 200px"
                                                            ></h:graphicImage>
                    </p:dialog>
                        
                            <h:panelGrid columns="2" style="alignment-baseline: central" rendered="false">  
                            <p:panel header="Exportar Todo">  
                                <h:commandLink>  
                                    <p:graphicImage value="/images/excel.png" height="20" style="border-width: 0px" />  
                                    <p:dataExporter type="xls" target="gacetaTable" fileName="gacetaFile" postProcessor="#{gacetaMB.postProcessXLS}"/>  
                                </h:commandLink>  

                                <h:commandLink>  
                                    <p:graphicImage value="/images/pdf.png" height="20" style="border-width: 0px"/>  
                                    <p:dataExporter type="pdf" target="gacetaTable" fileName="gacetaFile" preProcessor="#{gacetaMB.preProcessPDF}"/>  
                                </h:commandLink>  

                                <h:commandLink>  
                                    <p:graphicImage value="/images/csv.png" height="20" style="border-width: 0px"/>  
                                    <p:dataExporter type="csv" target="gacetaTable" fileName="gacetaFile" />  
                                </h:commandLink>  

                                <h:commandLink>  
                                    <p:graphicImage value="/images/xml.png" height="20" style="border-width: 0px"/>  
                                    <p:dataExporter type="xml" target="gacetaTable" fileName="gacetaFile" />  
                                </h:commandLink>  
                            </p:panel>  

                            <p:panel header="Exportar Página">  
                                <h:commandLink>  
                                    <p:graphicImage value="/images/excel.png" height="20" style="border-width: 0px"/>  
                                    <p:dataExporter type="xls" target="gacetaTable" fileName="gacetaFile" pageOnly="true" postProcessor="#{gacetaMB.postProcessXLS}"/>  
                                </h:commandLink>  

                                <h:commandLink>  
                                    <p:graphicImage value="/images/pdf.png" height="20" style="border-width: 0px"/>  
                                    <p:dataExporter type="pdf" target="gacetaTable" fileName="gacetaFile" pageOnly="true" preProcessor="#{gacetaMB.preProcessPDF}"/>  
                                </h:commandLink>  

                                <h:commandLink>  
                                    <p:graphicImage value="/images/csv.png" height="20" style="border-width: 0px"/>  
                                    <p:dataExporter type="csv" target="gacetaTable" fileName="gacetaFile" pageOnly="true"/>  
                                </h:commandLink>  

                                <h:commandLink>  
                                    <p:graphicImage value="/images/xml.png" height="20" style="border-width: 0px"/>  
                                    <p:dataExporter type="xml" target="gacetaTable" fileName="gacetaFile" pageOnly="true"/>  
                                </h:commandLink>  
                            </p:panel>  
                        </h:panelGrid>  
                       </p:fieldset>
                                
                       
                    </p:panel>
          
         
                </h:form>
            </h:body>

        </f:view>
    </ui:define>
</ui:composition>